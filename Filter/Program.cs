using System;
using System.Collections.Generic;
using System.IO;

namespace Filter
{
    class Program
    {
        static void Main(string[] args)
        {
            var locations = new List<Location>
            {
                new Location(-39.24288536425609, 175.56105078214367, 1764.11578369, 5, 4, new DateTime(2019, 9, 22, 10, 31, 22, 80)),
            new Location(-39.24287723381001, 175.56103837692697, 1765.69366455, 5, 4, new DateTime(2019, 9, 22, 10, 31, 23, 80)),
            new Location(-39.24286185301769, 175.56102588789125, 1765.0178833, 5, 4, new DateTime(2019, 9, 22, 10, 31, 24, 74)),
            new Location(-39.24283972479332, 175.56100979463716, 1765.92803955, 5, 4, new DateTime(2019, 9, 22, 10, 31, 25, 69)),
            new Location(-39.242818434759265, 175.56099755705853, 1765.40167236, 5, 4, new DateTime(2019, 9, 22, 10, 31, 26, 69)),
            new Location(-39.242798611558264, 175.56098808550794, 1765.21905518, 5, 4, new DateTime(2019, 9, 22, 10, 31, 27, 66)),
            new Location(-39.24277870453823, 175.56097744049092, 1765.20343018, 5, 4, new DateTime(2019, 9, 22, 10, 31, 28, 70)),
            new Location(-39.2427603900798, 175.56096453236003, 1765.67022705, 5, 4, new DateTime(2019, 9, 22, 10, 31, 29, 73)),
            new Location(-39.24274429682571, 175.56095371970494, 1765.33551025, 5, 4, new DateTime(2019, 9, 22, 10, 31, 30, 65)),
            new Location(-39.2427310534187, 175.5609461759921, 1764.59942627, 5, 4, new DateTime(2019, 9, 22, 10, 31, 31, 65)),
            new Location(-39.24271718136895, 175.56093737499376, 1764.62628174, 5, 6, new DateTime(2019, 9, 22, 10, 31, 32, 65)),
            new Location(-39.24270418941904, 175.56092740052898, 1764.49664307, 5, 4, new DateTime(2019, 9, 22, 10, 31, 33, 59)),
            new Location(-39.24269295766879, 175.56091172637005, 1765.05450439, 5, 4, new DateTime(2019, 9, 22, 10, 31, 34, 67)),
            new Location(-39.24267858270485, 175.56089487874468, 1764.84552002, 5, 4, new DateTime(2019, 9, 22, 10, 31, 35, 60)),
            new Location(-39.24266240563173, 175.5608782825764, 1764.8928833, 5, 4, new DateTime(2019, 9, 22, 10, 31, 36, 63)),
            new Location(-39.24264702483941, 175.56086252459843, 1764.80792236, 5, 4, new DateTime(2019, 9, 22, 10, 31, 37, 63)),
            new Location(-39.24263495489884, 175.5608486944582, 1765.24420166, 5, 4, new DateTime(2019, 9, 22, 10, 31, 38, 66)),
            new Location(-39.242623178324884, 175.56083528341313, 1764.93731689, 5, 4, new DateTime(2019, 9, 22, 10, 31, 39, 64)),
            new Location(-39.24261060547013, 175.56082271055837, 1764.70343018, 5, 6, new DateTime(2019, 9, 22, 10, 31, 40, 64)),
            new Location(-39.242599499448424, 175.56081147880812, 1764.76593018, 5, 4, new DateTime(2019, 9, 22, 10, 31, 41, 66)),
            new Location(-39.242590069807356, 175.56079966032465, 1765.02423096, 5, 4, new DateTime(2019, 9, 22, 10, 31, 42, 69)),
            new Location(-39.24257707785744, 175.56078775802214, 1764.87139893, 5, 4, new DateTime(2019, 9, 22, 10, 31, 43, 66)),
            new Location(-39.24256199043173, 175.56077769973834, 1764.45709229, 5, 4, new DateTime(2019, 9, 22, 10, 31, 44, 64)),
            new Location(-39.24254497516829, 175.56076931783517, 1764.706604, 5, 4, new DateTime(2019, 9, 22, 10, 31, 45, 66)),
            new Location(-39.242527247443086, 175.56075976246555, 1764.82159424, 5, 4, new DateTime(2019, 9, 22, 10, 31, 46, 65)),
            new Location(-39.24250725660402, 175.56075029091497, 1765.13311768, 5, 4, new DateTime(2019, 9, 22, 10, 31, 47, 66)),
            new Location(-39.24248894214559, 175.56074157373567, 1765.45391846, 5, 4, new DateTime(2019, 9, 22, 10, 31, 48, 63)),
            new Location(-39.242470208592, 175.56073562258442, 1765.62799072, 5, 4, new DateTime(2019, 9, 22, 10, 31, 49, 67)),
            new Location(-39.2424575100087, 175.56073361092766, 1765.03155518, 5, 4, new DateTime(2019, 9, 22, 10, 31, 50, 63)),
            new Location(-39.242444182782656, 175.56073101253767, 1765.42803955, 5, 3, new DateTime(2019, 9, 22, 10, 31, 51, 66)),
            new Location(-39.242434375955945, 175.56072749213834, 1765.62091064, 5, 3, new DateTime(2019, 9, 22, 10, 31, 52, 69)),
            new Location(-39.24242276702005, 175.56072011606355, 1765.62530518, 5, 3, new DateTime(2019, 9, 22, 10, 31, 53, 61)),
            new Location(-39.24241044562239, 175.56070980632265, 1765.65997314, 5, 4, new DateTime(2019, 9, 22, 10, 31, 54, 67)),
            new Location(-39.242402608542925, 175.56070452572365, 1765.7901001, 5, 4, new DateTime(2019, 9, 22, 10, 31, 55, 64)),
            new Location(-39.24239586111087, 175.56070217879076, 1765.85748291, 5, 4, new DateTime(2019, 9, 22, 10, 31, 56, 66)),
            new Location(-39.24237939067114, 175.56070293316205, 1766.01153564, 5, 4, new DateTime(2019, 9, 22, 10, 31, 57, 66)),
            new Location(-39.24235772345144, 175.5607038551714, 1766.17706299, 5, 4, new DateTime(2019, 9, 22, 10, 31, 58, 67)),
            new Location(-39.24233844507415, 175.5607043580856, 1766.07794189, 5, 4, new DateTime(2019, 9, 22, 10, 31, 59, 67)),
            new Location(-39.24231514338333, 175.56070444190462, 1766.16436768, 5, 4, new DateTime(2019, 9, 22, 10, 32, 0, 68)),
            new Location(-39.24229318279702, 175.56070645356138, 1766.35186768, 5, 4, new DateTime(2019, 9, 22, 10, 32, 1, 67)),
            new Location(-39.24227214422006, 175.56070980632265, 1766.24005127, 5, 4, new DateTime(2019, 9, 22, 10, 32, 2, 65)),
            new Location(-39.24225026745278, 175.56070930340846, 1766.39093018, 5, 4, new DateTime(2019, 9, 22, 10, 32, 3, 64)),
            new Location(-39.24222809731889, 175.56070553155203, 1766.47003174, 5, 4, new DateTime(2019, 9, 22, 10, 32, 4, 67)),
            new Location(-39.24220869321305, 175.56069840693434, 1766.2354126, 5, 4, new DateTime(2019, 9, 22, 10, 32, 5, 64)),
            new Location(-39.24219151031155, 175.56068943829794, 1765.82696533, 5, 4, new DateTime(2019, 9, 22, 10, 32, 6, 66)),
            new Location(-39.2421784345426, 175.5606795476522, 1765.74151611, 5, 3, new DateTime(2019, 9, 22, 10, 32, 7, 65)),
            new Location(-39.24215923998434, 175.56066957318743, 1765.57476807, 5, 3, new DateTime(2019, 9, 22, 10, 32, 8, 78)),
            new Location(-39.242136818393355, 175.56065951490362, 1765.67462158, 5, 3, new DateTime(2019, 9, 22, 10, 32, 9, 68)),
            new Location(-39.242117791473156, 175.5606518035527, 1765.20220947, 5, 3, new DateTime(2019, 9, 22, 10, 32, 10, 68)),
            new Location(-39.24210102766681, 175.5606449303921, 1765.27593994, 5, 3, new DateTime(2019, 9, 22, 10, 32, 11, 69)),
            new Location(-39.24208891581673, 175.56063788959344, 1765.31573486, 5, 3, new DateTime(2019, 9, 22, 10, 32, 12, 70)),
            new Location(-39.242078145071154, 175.5606322737183, 1765.03057861, 5, 3, new DateTime(2019, 9, 22, 10, 32, 13, 69)),
            new Location(-39.242066410406714, 175.56062741221447, 1765.27813721, 5, 3, new DateTime(2019, 9, 22, 10, 32, 14, 69)),
            new Location(-39.242052747904545, 175.56062548437674, 1765.43927002, 5, 3, new DateTime(2019, 9, 22, 10, 32, 15, 66)),
            new Location(-39.24203409816999, 175.560626154929, 1765.40167236, 5, 3, new DateTime(2019, 9, 22, 10, 32, 16, 64)),
            new Location(-39.24201549034495, 175.5606259034719, 1765.12823486, 5, 3, new DateTime(2019, 9, 22, 10, 32, 17, 70)),
            new Location(-39.24199575096298, 175.56062162870128, 1765.24298096, 5, 3, new DateTime(2019, 9, 22, 10, 32, 18, 67)),
            new Location(-39.24197374846715, 175.56061140277941, 1765.29180908, 5, 3, new DateTime(2019, 9, 22, 10, 32, 19, 67)),
            new Location(-39.24195069823343, 175.5605954771634, 1765.43096924, 5, 3, new DateTime(2019, 9, 22, 10, 32, 20, 74)),
            new Location(-39.24193259332258, 175.56058206611831, 1765.73760986, 5, 3, new DateTime(2019, 9, 22, 10, 32, 21, 64)),
            new Location(-39.24192521724779, 175.56057879717608, 1765.5647583, 5, 3, new DateTime(2019, 9, 22, 10, 32, 22, 68)),
            new Location(-39.24192492388118, 175.5605791324522, 1765.23028564, 5, 3, new DateTime(2019, 9, 22, 10, 32, 23, 63)),
            new Location(-39.24181461803544, 175.56056362593134, 1764.18267822, 5, 3, new DateTime(2019, 9, 22, 10, 32, 56, 76)),
            new Location(-39.24178771212626, 175.5605775398906, 1764.53497314, 5, 3, new DateTime(2019, 9, 22, 10, 32, 57, 67)),
            new Location(-39.24176910430122, 175.56058508360346, 1764.48565674, 5, 3, new DateTime(2019, 9, 22, 10, 32, 58, 73)),
            new Location(-39.24176223114062, 175.56058525124152, 1764.53643799, 5, 3, new DateTime(2019, 9, 22, 10, 32, 59, 68)),
            new Location(-39.241754980794376, 175.56058181466122, 1764.3928833, 5, 3, new DateTime(2019, 9, 22, 10, 33, 0, 61)),
            new Location(-39.24174207266349, 175.5605809764709, 1764.58135986, 5, 3, new DateTime(2019, 9, 22, 10, 33, 1, 62)),
            new Location(-39.24172694332827, 175.56058181466122, 1763.75030518, 5, 3, new DateTime(2019, 9, 22, 10, 33, 2, 59)),
            new Location(-39.24171667549688, 175.56058265285154, 1763.65386963, 5, 3, new DateTime(2019, 9, 22, 10, 33, 3, 68)),
            new Location(-39.24170913178403, 175.56058298812766, 1762.81500244, 5, 3, new DateTime(2019, 9, 22, 10, 33, 4, 62)),
            new Location(-39.24170305490423, 175.56058449687023, 1762.76885986, 5, 3, new DateTime(2019, 9, 22, 10, 33, 5, 62)),
            new Location(-39.24169542737234, 175.56058424541314, 1762.58624268, 5, 3, new DateTime(2019, 9, 22, 10, 33, 6, 71)),
            new Location(-39.24167857974697, 175.56058206611831, 1762.77081299, 5, 3, new DateTime(2019, 9, 22, 10, 33, 7, 69)),
            new Location(-39.24164970409054, 175.56058558651765, 1762.51641846, 5, 3, new DateTime(2019, 9, 22, 10, 33, 8, 58)),
            new Location(-39.2416051961847, 175.5605952257063, 1762.36016846, 5, 3, new DateTime(2019, 9, 22, 10, 33, 9, 94)),
            new Location(-39.24155037853796, 175.56060494871397, 1761.64996338, 5, 4, new DateTime(2019, 9, 22, 10, 33, 10, 7)),
            new Location(-39.241492752953654, 175.56060511635204, 1761.52764893, 5, 4, new DateTime(2019, 9, 22, 10, 33, 11, 8)),
            new Location(-39.241466140411084, 175.56060167977174, 1760.43096924, 5, 4, new DateTime(2019, 9, 22, 10, 33, 12, 64)),
            new Location(-39.24146375156868, 175.56059966811497, 1760.12774658, 5, 4, new DateTime(2019, 9, 22, 10, 33, 13, 70)),
            new Location(-39.2414627457403, 175.56059757263918, 1760.07403564, 5, 4, new DateTime(2019, 9, 22, 10, 33, 14, 63)),
            new Location(-39.24146375156868, 175.56059413605888, 1759.23028564, 5, 4, new DateTime(2019, 9, 22, 10, 33, 15, 60)),
            new Location(-39.2414680263393, 175.56058743053634, 1759.19927979, 5, 6, new DateTime(2019, 9, 22, 10, 33, 16, 67)),
            new Location(-39.241473432666844, 175.56058030591865, 1759.34307861, 5, 4, new DateTime(2019, 9, 22, 10, 33, 17, 74)),
            new Location(-39.24147892281342, 175.56057611496706, 1758.58624268, 5, 4, new DateTime(2019, 9, 22, 10, 33, 18, 61)),
            new Location(-39.24148349095065, 175.56057401949127, 1758.55181885, 10, 4, new DateTime(2019, 9, 22, 10, 33, 19, 65)),
            new Location(-39.24148349095065, 175.56057401949127, 1758.92510986, 5, 4, new DateTime(2019, 9, 22, 10, 33, 20, 59)),
            new Location(-39.24149178903479, 175.56057259456773, 1759.31500244, 5, 4, new DateTime(2019, 9, 22, 10, 33, 21, 78)),
            new Location(-39.24139648679573, 175.5606327766325, 1757.20977783, 5, 4, new DateTime(2019, 9, 22, 10, 33, 33, 73)),
            new Location(-39.241381357460504, 175.56064694204886, 1757.02423096, 5, 4, new DateTime(2019, 9, 22, 10, 33, 34, 74)),
            new Location(-39.24136149234999, 175.56066965700646, 1756.75421143, 5, 3, new DateTime(2019, 9, 22, 10, 33, 35, 64)),
            new Location(-39.24133345488388, 175.56069421598275, 1756.77471924, 5, 3, new DateTime(2019, 9, 22, 10, 33, 36, 82)),
            new Location(-39.24130386676568, 175.5607141649123, 1756.61407471, 5, 3, new DateTime(2019, 9, 22, 10, 33, 37, 71)),
            new Location(-39.24127888869423, 175.56073126399477, 1756.51324463, 5, 4, new DateTime(2019, 9, 22, 10, 33, 38, 67)),
            new Location(-39.241259023583716, 175.5607429986592, 1754.88018799, 5, 3, new DateTime(2019, 9, 22, 10, 33, 39, 70)),
            new Location(-39.2412391584732, 175.56075657734235, 1754.95074463, 5, 3, new DateTime(2019, 9, 22, 10, 33, 40, 74)),
            new Location(-39.24123031556535, 175.56075867281814, 1754.92462158, 5, 3, new DateTime(2019, 9, 22, 10, 33, 41, 80)),
            new Location(-39.24122905827988, 175.56076286376972, 1754.68878174, 5, 3, new DateTime(2019, 9, 22, 10, 33, 42, 73)),
            new Location(-39.24123077657003, 175.5607601815607, 1754.53643799, 5, 3, new DateTime(2019, 9, 22, 10, 33, 43, 71)),
            new Location(-39.241231321393734, 175.5607577508088, 1754.47637939, 5, 3, new DateTime(2019, 9, 22, 10, 33, 44, 71)),
            new Location(-39.241231321393734, 175.5607595948275, 1754.43707275, 5, 3, new DateTime(2019, 9, 22, 10, 33, 45, 69)),
            new Location(-39.24122784290392, 175.56076261231263, 1754.18438721, 5, 3, new DateTime(2019, 9, 22, 10, 33, 46, 76)),
            new Location(-39.241223526223784, 175.5607620255794, 1754.24176025, 5, 3, new DateTime(2019, 9, 22, 10, 33, 47, 72)),
            new Location(-39.24122335858572, 175.56076009774168, 1754.20294189, 5, 3, new DateTime(2019, 9, 22, 10, 33, 48, 75)),
            new Location(-39.24122335858572, 175.56076009774168, 1754.22149658, 10, 3, new DateTime(2019, 9, 22, 10, 33, 49, 71)),
            new Location(-39.24122335858572, 175.56076009774168, 1753.70196533, 10, 3, new DateTime(2019, 9, 22, 10, 33, 50, 77)),
            new Location(-39.241289701349324, 175.5608688110258, 1747.2991333, 30, 3, new DateTime(2019, 9, 22, 10, 34, 30, 76)),
            new Location(-39.24133990894932, 175.56097534501512, 1746.25787354, 30, 4, new DateTime(2019, 9, 22, 10, 34, 34, 70)),
            new Location(-39.24133990894932, 175.56097534501512, 1746.25787354, 30, 4, new DateTime(2019, 9, 22, 10, 34, 34, 70)),
            new Location(-39.24111954191342, 175.56057944635648, 1740.20288086, 481.941650390625, 32, new DateTime(2019, 9, 22, 10, 36, 23, 756)),
            new Location(-39.24035300275422, 175.5592928536202, 1740.20288086, 482.61114501953125, 32, new DateTime(2019, 9, 22, 10, 36, 24, 643)),
            new Location(-39.24007781298626, 175.55883096311882, 1740.20288086, 483.10791015625, 32, new DateTime(2019, 9, 22, 10, 36, 25, 362)),
            new Location(-39.2399476437071, 175.55861248132695, 1740.20288086, 499.6839599609375, 32, new DateTime(2019, 9, 22, 10, 36, 29, 606)),
            new Location(-39.2398371456434, 175.55842701656047, 1740.20288086, 499.90679931640625, 32, new DateTime(2019, 9, 22, 10, 36, 30, 121)),
            new Location(-39.239529852155, 175.5579112417754, 1740.20288086, 715.4459228515625, 32, new DateTime(2019, 9, 22, 10, 36, 50, 784)),
            new Location(-39.23940374886271, 175.5576995845131, 1740.20288086, 716.7548828125, 32, new DateTime(2019, 9, 22, 10, 36, 53, 251)),
            new Location(-39.23923988152701, 175.55742454243432, 1740.20288086, 716.9406127929688, 32, new DateTime(2019, 9, 22, 10, 36, 54, 98)),
            new Location(-39.23918423802185, 175.5573311479499, 1740.20288086, 716.9406127929688, 32, new DateTime(2019, 9, 22, 10, 36, 32, 101)),
            new Location(-39.239110594966775, 175.55720754223637, 1740.20288086, 727.5244140625, 32, new DateTime(2019, 9, 22, 10, 37, 0, 656)),
            new Location(-39.23905544181173, 175.55711497077692, 1740.20288086, 735.3841552734375, 32, new DateTime(2019, 9, 22, 10, 37, 6, 825)),

        };

            Algorithm filter = null;
            KalmanLatLong secondFilter = new KalmanLatLong(0F);

            

            //using (StreamWriter file =
            //    new StreamWriter(@"C:\path.txt"))
            //{
            //    foreach (var location in locations)
            //    {
            //        file.Write($"{location.Latitude},{location.Longitude} ");
            //    }
            //}

            int i = 0;

            using (StreamWriter file =
                new StreamWriter(@"C:\Alg1.txt"), jsFile = new StreamWriter(@"C:\Alg2.txt") )
            {
                file.Write("[map]");
                jsFile.Write("[map]");
                foreach (var location in locations)
                {
                    if (filter == null)
                    {
                        filter = new Algorithm(location);
                        continue;

                    }

                    if (i == 0)
                    {
                        i++;
                        secondFilter.SetState(location.Latitude, location.Longitude, location.HorizontalAccuracy, location.Timestamp.ToUnixTimeMilliseconds());
                        continue;
                        
                    }

                    var jsKalmanLocation = secondFilter.Process(location.Latitude, location.Longitude,
                        location.HorizontalAccuracy, location.Timestamp.ToUnixTimeMilliseconds());
                    var kalmanLocation = filter.ProcessState(location);

                    file.Write($"{kalmanLocation.Latitude},{kalmanLocation.Longitude} ");
                    Console.WriteLine($" {kalmanLocation.Latitude}  {kalmanLocation.Longitude} ");

                    jsFile.Write($"{jsKalmanLocation.Latitude},{jsKalmanLocation.Longitude} ");
                    Console.WriteLine($" {jsKalmanLocation.Latitude}  {jsKalmanLocation.Longitude} ");
                }

                file.Write("[/map]");
                jsFile.Write("[/map]");
            }

            Console.ReadKey();
            File.Delete(@"C:\path.txt");
        }
    }
}
